<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de PlaneaciÃ³n de Reforestaciones</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <div class="logo-section">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRo8-Vr5qw1QlEE9lM2RnEei0Sr3k0fpod9Bw&s" alt="Logo de la Empresa" class="company-logo">
            <div class="header-text">
                <h1>Sistema de PlaneaciÃ³n de Reforestaciones</h1>
                <div class="subtitle">Herramienta profesional para diseÃ±o de proyectos ambientales</div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="main-container">
        <div class="sidebar">
            <!-- Carga de Imagen -->
            <div class="section">
                <h3>ğŸ“¸ Imagen Satelital</h3>
                <div class="file-input">
                    <label for="imageInput">Subir Imagen</label>
                    <input type="file" id="imageInput" accept="image/*">
                </div>
                <div id="imageInfo" style="display:none;">
                    <p><strong>Imagen cargada:</strong> <span id="imageName"></span></p>
                    <div class="controls">
                        <button class="btn btn-secondary" onclick="clearImage()">Limpiar</button>
                    </div>
                </div>
            </div>

            <!-- Escalado -->
            <div class="section">
                <h3>ğŸ“ Escalado Manual</h3>
                <button id="scaleBtn" class="btn" onclick="startScaling()">Definir Escala</button>
                <div id="scaleInfo" style="display:none; margin-top:0.5rem;">
                    <div class="input-group">
                        <label for="realLength">Longitud real (metros):</label>
                        <input type="number" id="realLength" placeholder="Ej: 5" step="0.1">
                        <button class="btn" onclick="setScale()">Confirmar Escala</button>
                    </div>
                </div>
                <div id="scaleResult" style="display:none; margin-top:0.5rem;">
                    <div class="alert alert-success">
                        <strong>Escala:</strong> <span id="scaleValue"></span>
                    </div>
                </div>
            </div>

            <!-- DelimitaciÃ³n -->
            <div class="section">
                <h3>ğŸ—ºï¸ Delimitar Predio</h3>
                <div class="controls">
                    <button id="polygonBtn" class="btn" onclick="startPolygon()">Dibujar Ãrea</button>
                    <button class="btn btn-danger" onclick="clearPolygon()">Limpiar</button>
                </div>
                <div id="polygonInfo" style="display:none; margin-top:0.5rem;">
                    <div class="alert alert-success">
                        <strong>Ãrea:</strong> <span id="polygonArea"></span> mÂ²
                    </div>
                </div>
            </div>

            <!-- LÃ­neas GuÃ­a -->
            <div class="section">
                <h3>ğŸ“ LÃ­neas GuÃ­a</h3>
                <div class="tree-category-section">
                    <div class="tree-category-title">ğŸ“ Herramientas de AlineaciÃ³n</div>
                    <div class="controls" style="margin-bottom: 1rem;">
                        <button class="btn" onclick="startGuidelineMode('line')" style="background: linear-gradient(135deg, #9c27b0 0%, #ba68c8 100%);">ğŸ“ LÃ­nea</button>
                        <button class="btn" onclick="toggleSnapToGuides()" id="snapToggleBtn">ğŸ§² Snap ON</button>
                        <button class="btn" onclick="toggleGuidelineMeasurements()" id="measureToggleBtn">ğŸ“ Medidas ON</button>
                        <button class="btn" onclick="toggleGuidelinesVisibility()">ğŸ‘ï¸ Mostrar/Ocultar</button>
                        <button class="btn btn-danger" onclick="clearGuidelines()">ğŸ—‘ï¸ Limpiar</button>
                    </div>
                </div>
            </div>

            <!-- TuberÃ­as -->
            <div class="section">
                <h3>ğŸ”§ Infraestructura - TuberÃ­as</h3>
                <div class="tree-category-section">
                    <div class="tree-category-title">ğŸš° Tipos de Infraestructura</div>
                    <div class="controls" style="margin-bottom: 1rem;">
                        <button id="gasLineBtn" class="btn" onclick="startDrawingPipeline('gas')" style="background: linear-gradient(135deg, #ffc107 0%, #ffeb3b 100%);">â›½ TuberÃ­a Gas</button>
                        <button id="waterLineBtn" class="btn" onclick="startDrawingPipeline('agua')" style="background: linear-gradient(135deg, #2196f3 0%, #42a5f5 100%);">ğŸ’§ TuberÃ­a Agua</button>
                        <button id="electricLineBtn" class="btn" onclick="startDrawingPipeline('electrica')" style="background: linear-gradient(135deg, #ff5722 0%, #ff7043 100%);">âš¡ Red ElÃ©ctrica</button>
                        <button class="btn" onclick="clearPipelines()">ğŸ—‘ï¸ Limpiar Todo</button>
                    </div>
                    <div id="pipelineInfo" style="display:none; margin-top:0.5rem;">
                        <div class="alert alert-success">
                            <strong>Infraestructura mapeada:</strong> <span id="pipelineCount">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tipos de Ãrboles -->
            <div class="section">
                <h3>ğŸŒ² Tipos de Ãrboles</h3>
                
                <!-- Ãrboles Nuevos -->
                <div class="tree-category-section">
                    <div class="tree-category-title collapsed" onclick="toggleTreeCategory('nuevos')" id="nuevos-header">
                        <span>ğŸŒ± Ãrboles Nuevos</span>
                        <span class="dropdown-arrow" id="nuevos-arrow">â–¼</span>
                    </div>
                    <div class="tree-types-container" id="nuevos-content">
                        <div class="tree-types">
                            <div class="tree-item" draggable="true" data-type="NUEVO_3M" data-category="nuevo">
                                <div class="tree-icon tree-nuevo">ğŸŒ±</div>
                                <div class="tree-name">Nuevo 3m</div>
                                <div class="tree-size">DiÃ¡metro: 3m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="NUEVO_4M" data-category="nuevo">
                                <div class="tree-icon tree-nuevo">ğŸŒ¿</div>
                                <div class="tree-name">Nuevo 4m</div>
                                <div class="tree-size">DiÃ¡metro: 4m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="NUEVO_5M" data-category="nuevo">
                                <div class="tree-icon tree-nuevo">ğŸŒ²</div>
                                <div class="tree-name">Nuevo 5m</div>
                                <div class="tree-size">DiÃ¡metro: 5m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="NUEVO_6M" data-category="nuevo">
                                <div class="tree-icon tree-nuevo">ğŸŒ³</div>
                                <div class="tree-name">Nuevo 6m</div>
                                <div class="tree-size">DiÃ¡metro: 6m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="NUEVO_7M" data-category="nuevo">
                                <div class="tree-icon tree-nuevo">ğŸŒ´</div>
                                <div class="tree-name">Nuevo 7m</div>
                                <div class="tree-size">DiÃ¡metro: 7m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="NUEVO_8M" data-category="nuevo">
                                <div class="tree-icon tree-nuevo">ğŸŒ²</div>
                                <div class="tree-name">Nuevo 8m</div>
                                <div class="tree-size">DiÃ¡metro: 8m</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ãrboles Existentes -->
                <div class="tree-category-section">
                    <div class="tree-category-title collapsed" onclick="toggleTreeCategory('existentes')" id="existentes-header">
                        <span>ğŸŒ³ Ãrboles Existentes</span>
                        <span class="dropdown-arrow" id="existentes-arrow">â–¼</span>
                    </div>
                    <div class="tree-types-container" id="existentes-content">
                        <div class="tree-types">
                            <div class="tree-item" draggable="true" data-type="EXISTENTE_1M" data-category="existente">
                                <div class="tree-icon tree-existente">ğŸŒ¿</div>
                                <div class="tree-name">Exist. 1m</div>
                                <div class="tree-size tree-size-small">DiÃ¡metro: 1m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="EXISTENTE_2M" data-category="existente">
                                <div class="tree-icon tree-existente">ğŸŒ±</div>
                                <div class="tree-name">Exist. 2m</div>
                                <div class="tree-size tree-size-small">DiÃ¡metro: 2m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="EXISTENTE_3M" data-category="existente">
                                <div class="tree-icon tree-existente">ğŸŒ²</div>
                                <div class="tree-name">Exist. 3m</div>
                                <div class="tree-size tree-size-small">DiÃ¡metro: 3m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="EXISTENTE_4M" data-category="existente">
                                <div class="tree-icon tree-existente">ğŸŒ³</div>
                                <div class="tree-name">Exist. 4m</div>
                                <div class="tree-size tree-size-small">DiÃ¡metro: 4m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="EXISTENTE_5M" data-category="existente">
                                <div class="tree-icon tree-existente">ğŸŒ´</div>
                                <div class="tree-name">Exist. 5m</div>
                                <div class="tree-size tree-size-small">DiÃ¡metro: 5m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="EXISTENTE_6M" data-category="existente">
                                <div class="tree-icon tree-existente">ğŸŒ²</div>
                                <div class="tree-name">Exist. 6m</div>
                                <div class="tree-size tree-size-small">DiÃ¡metro: 6m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="EXISTENTE_7M" data-category="existente">
                                <div class="tree-icon tree-existente">ğŸŒ³</div>
                                <div class="tree-name">Exist. 7m</div>
                                <div class="tree-size tree-size-small">DiÃ¡metro: 7m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="EXISTENTE_8M" data-category="existente">
                                <div class="tree-icon tree-existente">ğŸŒ´</div>
                                <div class="tree-name">Exist. 8m</div>
                                <div class="tree-size tree-size-small">DiÃ¡metro: 8m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="EXISTENTE_9M" data-category="existente">
                                <div class="tree-icon tree-existente">ğŸŒ²</div>
                                <div class="tree-name">Exist. 9m</div>
                                <div class="tree-size tree-size-small">DiÃ¡metro: 9m</div>
                            </div>
                            <div class="tree-item" draggable="true" data-type="EXISTENTE_10M" data-category="existente">
                                <div class="tree-icon tree-existente">ğŸŒ³</div>
                                <div class="tree-name">Exist. 10m</div>
                                <div class="tree-size tree-size-small">DiÃ¡metro: 10m</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Capas Visuales -->
            <div class="section">
                <h3>ğŸ‘ï¸ Capas Visuales</h3>
                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="showGrowthCircles" checked onchange="toggleLayer('growthCircles')">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">CÃ­rculos de crecimiento</span>
                </div>
                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="showTreeLabels" checked onchange="toggleLayer('treeLabels')">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">Nombres de Ã¡rboles</span>
                </div>
                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="showPolygon" checked onchange="toggleLayer('polygon')">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">LÃ­mites del predio</span>
                </div>
                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="showPipelines" checked onchange="toggleLayer('pipelines')">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">TuberÃ­as</span>
                </div>
                <div class="toggle-container">
                    <label class="toggle">
                        <input type="checkbox" id="showLegend" checked onchange="toggleLayerLegend()">
                        <span class="slider"></span>
                    </label>
                    <span class="toggle-label">Mostrar leyenda</span>
                </div>
            </div>

            <!-- Acciones -->
            <div class="section">
                <h3>âš¡ Acciones</h3>
                <div class="controls">
                    <button class="btn" onclick="generateReport()">ğŸ“Š Reporte</button>
                    <button class="btn" onclick="exportReportToPNG()">ğŸ“„ Exportar Reporte</button>
                    <button class="btn" onclick="exportProject()">ğŸ’¾ Guardar</button>
                    <button class="btn" onclick="loadProject()">ğŸ“‚ Cargar</button>
                    <button class="btn" onclick="exportToPNG()">ğŸ“¸ Exportar Imagen</button>
                    <button class="btn" onclick="exportLegendToPNG()">ğŸ¨ Exportar Leyenda</button>
                    <button class="btn btn-danger" onclick="clearAll()">ğŸ—‘ï¸ Limpiar Todo</button>
                </div>
            </div>
        </div>

        <div class="workspace">
            <div class="workspace-header">
                <div class="project-name-container">
                    <span>ğŸ—ºï¸</span>
                    <span id="projectNameDisplay" class="project-name-display" onclick="editProjectName()" title="Clic para editar nombre del proyecto">
                        Proyecto de ReforestaciÃ³n
                    </span>
                    <input type="text" id="projectNameInput" class="project-name-input" style="display: none;" 
                           placeholder="Nombre del proyecto" maxlength="50">
                    <button id="editProjectBtn" class="edit-project-btn" onclick="editProjectName()" title="Editar nombre del proyecto">
                        âœï¸
                    </button>
                    <button id="saveProjectBtn" class="save-project-btn" onclick="saveProjectName()" style="display: none;" title="Guardar nombre">
                        âœ“
                    </button>
                </div>
                <div class="controls">
                    <button class="btn" onclick="zoomIn()" title="Acercar">ğŸ”+</button>
                    <button class="btn" onclick="zoomOut()" title="Alejar">ğŸ”-</button>
                    <button class="btn" onclick="resetZoom()" title="Restablecer Vista">ğŸ”„</button>
                    <button class="btn" onclick="exportToPNG()" title="Exportar Imagen">ğŸ“¸</button>
                    <button class="btn" onclick="exportLegendToPNG()" title="Exportar Leyenda">ğŸ¨</button>
                </div>
            </div>
            <div class="canvas-container" id="canvasContainer">
                <canvas id="mainCanvas" class="main-canvas"></canvas>
                
                <!-- BotÃ³n toggle de leyenda -->
                <button class="legend-toggle" id="legendToggle" onclick="toggleLegend()" title="Mostrar/Ocultar Leyenda">?</button>
                
                <!-- Leyenda de Colores -->
                <div class="legend collapsed" id="colorLegend">
                    <!-- Contenido generado dinÃ¡micamente -->
                </div>
            </div>
            <div class="status-bar">
                <span id="statusText">Listo para comenzar</span>
                <span id="treeCount">Ãrboles: 0</span>
            </div>
        </div>
    </div>

    <!-- Modal para Reporte -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('reportModal')">&times;</span>
            <h2>ğŸ“Š Reporte de ReforestaciÃ³n</h2>
            <div id="reportContent"></div>
            <div style="margin-top: 1rem; text-align: center;">
                <button class="btn" onclick="closeModal('reportModal')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Input oculto para cargar proyecto -->
    <input type="file" id="projectInput" accept=".json" style="display:none;">

    <!-- Scripts en orden de dependencia -->
    <script src="js/core/state-manager.js"></script>
    <script src="js/ui/toast-system.js"></script>
    <script src="js/ui/modals.js"></script>
    <script src="js/ui/legend.js"></script>
    <script src="js/core/canvas-engine.js"></script>
    <script src="js/core/event-handler.js"></script>
    <script src="js/features/image-management.js"></script>
    <script src="js/features/scaling.js"></script>
    <script src="js/features/area-delimitation.js"></script>
    <script src="js/features/tree-planting.js"></script>
    <script src="js/features/infrastructure.js"></script>
    <script src="js/features/project-management.js"></script>
    <script src="js/features/reporting.js"></script>
    <script src="js/app.js"></script>
</body>
</html>